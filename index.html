<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital@0;1&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Momo+Trust+Display&display=swap" rel="stylesheet">
    <title>EcoFinder</title>
</head>
<body>
    <header class="header">
        <section>
        <a href="#" class="logo">
            <img src="imagens/logo.png" alt="logo">
        </a>

        <nav class="navbar">
            <a href="#home">Home</a>
            <a href="#sobre">Sobre</a>
            <a href="#como-funciona?">Como Funciona?</a>
            <a href="#identifique-sua-planta">Identifique sua planta</a>
        </nav>

        </section>
    </header>

    <div class="home-container">
        <section id="home">
            <div class="content">
                <h3>Conecte-se com a natureza!Descubra diversas plantas e aprecie o papel especial de cada uma em nosso ecossistema</h3>
                <p>Para al√©m da identifica√ß√£o, fornecemos o passo a passo para o sucesso. Com o EcoFinder, cada encontro com a natureza se transforma em aprendizado.</p>
                <a href="#identifique-sua-planta" class="btn">Identifique sua planta</a>
            </div>
        </section>
    </div>

    <section class="sobre" id="sobre">
        <h2 class="title">Sobre <span>N√≥s</span></h2>
        <div class="row">
            <div class="container-image">
                <img src="imagens/brotos.jpg" width="500" height="300" alt="sobre-nos">
            </div>
            <div class="content">
                <h3>Descubra o mundo das plantas!</h3>
                <p>No EcoFinder, cada planta √© uma descoberta. Nossa plataforma ajuda voc√™ a identificar esp√©cies e conhecer suas particularidades: desde caracter√≠sticas √∫nicas e curiosidades at√© dicas de cuidado e orienta√ß√£o para manter suas plantas saud√°veis e bem cuidadas. Tudo de forma pr√°tica, simples e confi√°vel.</p>
                <p>Com nossa tecnologia, voc√™ transforma a curiosidade em conhecimento pr√°tico. Identifique instantaneamente qualquer planta, e obtenha guias de cuidado e orienta√ß√£o claros para garantir que voc√™ possa nutrir e entender a vida que te cerca.</p>
            </div>

        </div>
    </section>

    <section class="como-funciona" id="como-funciona?">
    <h2 class="title">Como <span>Funciona?</span></h2>

    <div class="steps-container">

        <div class="step">
            <span class="number">1</span>
            <h3>Envie uma Foto</h3>
            <p>Fa√ßa upload de uma imagem da planta que deseja identificar.</p>
        </div>

        <div class="step">
            <span class="number">2</span>
            <h3>A IA Analisa</h3>
            <p>Nossa intelig√™ncia artificial estuda a foto, detecta padr√µes e compara esp√©cies.</p>
        </div>

        <div class="step">
            <span class="number">3</span>
            <h3>Receba a Identifica√ß√£o</h3>
            <p>Veja o nome da planta, caracter√≠sticas e curiosidades sobre ela.</p>
        </div>

    </div>
    </section>

    <section class="identificar" id="identifique-sua-planta">
    <h2 class="title">Identifique <span>Sua Planta</span></h2>

    <div class="identificar-container" id="identificar-container">
        
        <!-- √Årea de resultado (aparece primeiro quando houver resultado) -->
        <div class="resultado-box" id="resultado-box" style="display: none;">
            <h3>Resultado</h3>
            <div id="resultado-conteudo">
                <p class="placeholder">
                    A identifica√ß√£o aparecer√° aqui ap√≥s enviarmos sua imagem para a IA.
                </p>
            </div>

            <!-- Preview da imagem no resultado -->
            <div class="preview-imagem" id="preview-resultado">
                <p>Nenhuma imagem enviada ainda...</p>
            </div>
        </div>

        <!-- √Årea de upload (vai para baixo quando houver resultado) -->
        <div class="upload-box" id="upload-box">
            <p>Envie uma foto da planta para iniciar a identifica√ß√£o</p>

            <label for="input-file" class="upload-area">
                üì∏ Clique para enviar uma imagem
            </label>
            
            <input type="file" id="input-file" accept="image/*" hidden>

            <button class="btn identificar-btn">Identificar Planta</button>
            
            <!-- Preview da imagem no upload (inicial) -->
            <div class="preview-imagem" id="preview-upload">
                <p>Nenhuma imagem enviada ainda...</p>
            </div>
        </div>

    </div>
    </section>

    <footer class="footer">
    <div class="footer-container">

        <div class="footer-logo">
            <img src="imagens/logo.png" alt="EcoFinder Logo">
            <p>Conectando voc√™ ao mundo das plantas.</p>
        </div>

        <div class="footer-links">
            <a href="#home">Home</a>
            <a href="#sobre">Sobre</a>
            <a href="#como-funciona?">Como Funciona?</a>
            <a href="#identifique-sua-planta">Identifica√ß√£o</a>
        </div>

        <p class="footer-copy">¬©Ô∏è 2025 EcoFinder ‚Äî Todos os direitos reservados.</p>

    </div>
    </footer>


    <script>
        const inputFile = document.getElementById("input-file");
        const btnIdentificar = document.querySelector(".identificar-btn");
        const previewUpload = document.getElementById("preview-upload");
        const previewResultado = document.getElementById("preview-resultado");
        const resultadoConteudo = document.getElementById("resultado-conteudo");
        const resultadoBox = document.getElementById("resultado-box");
        const identificarContainer = document.getElementById("identificar-container");

        let imagemSelecionada = null;

        const formatTexto = (valor, fallback = "N√£o informado") => {
            if (!valor) return fallback;
            if (typeof valor !== "string") return valor;
            return valor.trim() || fallback;
        };

        inputFile.addEventListener("change", () => {
            const file = inputFile.files[0];
            imagemSelecionada = file ?? null;

            if (!file) {
                if (previewUpload) {
                    previewUpload.innerHTML = "<p>Nenhuma imagem enviada ainda...</p>";
                    previewUpload.classList.remove("hidden");
                }
                return;
            }

            if (!file.type.startsWith("image/")) {
                alert("Por favor, selecione uma imagem!");
                return;
            }

            const url = URL.createObjectURL(file);
            if (previewUpload) {
                previewUpload.innerHTML = `
                    <img src="${url}"
                         style="max-width: 100%;
                                max-height: 400px;
                                border-radius: 10px;
                                display: block;
                                margin: 0 auto;
                                object-fit: contain;">
                `;
                previewUpload.style.display = "block";
                previewUpload.classList.remove("hidden");
            }

            if (btnIdentificar) {
                btnIdentificar.disabled = false;
                btnIdentificar.style.opacity = "1";
                btnIdentificar.style.cursor = "pointer";
            }
        });

        btnIdentificar.addEventListener("click", async () => {
            if (!imagemSelecionada) {
                alert("Envie uma imagem primeiro!");
                const file = inputFile.files[0];
                if (file) {
                    imagemSelecionada = file;
                } else {
                    return;
                }
            }

            if (resultadoBox) {
                resultadoBox.style.display = "block";
            }
            resultadoConteudo.innerHTML = "<p>‚è≥ Identificando a planta...</p>";

            const url = URL.createObjectURL(imagemSelecionada);
            if (previewResultado) {
                previewResultado.innerHTML = '<img src="' + url + '" style="max-width: 100%; border-radius: 10px;">';
            }
            if (previewUpload) {
                previewUpload.classList.add("hidden");
            }
            identificarContainer.classList.add("resultado-visivel");

            const formData = new FormData();
            formData.append("imagem", imagemSelecionada);

            try {
                const resp = await fetch("/identificar", {
                    method: "POST",
                    body: formData
                });

                const data = await resp.json();

                if (data.erro) {
                    resultadoConteudo.innerHTML = "<p>‚ùå Erro: " + data.erro + "</p>";
                    return;
                }

                if (data.resultado && typeof data.resultado === "object") {
                    const nome = formatTexto(data.resultado.nome, "Planta n√£o identificada");
                    const caracteristicas = (data.resultado.caracteristicas || []).slice(0, 3);
                    const clima = formatTexto(data.resultado.clima);
                    const confianca = Math.round(((data.resultado.confianca ?? 0) * 100));
                    const infoCards = [
                        { icon: "üìç", label: "Localidade", value: formatTexto(data.resultado.localidade) },
                        { icon: "üå±", label: "Ambiente", value: formatTexto(data.resultado.ambiente) },
                        { icon: "ü™¥", label: "Cultivo", value: formatTexto(data.resultado.cultivo) },
                        { icon: "üõ†Ô∏è", label: "Manejo", value: formatTexto(data.resultado.manejo) },
                        { icon: "üíß", label: "Rega", value: formatTexto(data.resultado.rega) },
                        { icon: "‚òÄÔ∏è", label: "Luz do Sol", value: formatTexto(data.resultado.sol) }
                    ];

                    let html = `
                        <div class="resultado-nome-card">
                            <div class="resultado-nome-icon">üåø</div>
                            <div class="resultado-nome-textos">
                                <h4 class="resultado-nome">${nome}</h4>
                                <div class="resultado-confianca">
                                    <span>${confianca}% de confian√ßa</span>
                                    <div class="resultado-confianca-bar">
                                        <span style="width:${Math.max(confianca, 5)}%;"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    if (caracteristicas.length > 0) {
                        html += `
                            <div class="resultado-secao-card">
                                <div class="resultado-secao-header">
                                    <span class="resultado-secao-icon">‚ú®</span>
                                    <h5 class="resultado-secao-titulo">Caracter√≠sticas</h5>
                                </div>
                                <ul class="resultado-lista">
                        `;
                        caracteristicas.forEach((caracteristica, index) => {
                            html += `
                                <li class="resultado-item" style="animation-delay: ${index * 0.1}s">
                                    <span class="resultado-item-bullet">‚óè</span>
                                    <span class="resultado-item-texto">${caracteristica}</span>
                                </li>
                            `;
                        });
                        html += `</ul></div>`;
                    }

                    html += `
                        <div class="resultado-info-grid">
                            ${infoCards.map(card => `
                                <div class="resultado-info-card">
                                    <span class="resultado-info-icon">${card.icon}</span>
                                    <div>
                                        <p class="resultado-info-label">${card.label}</p>
                                        <p class="resultado-info-value">${card.value}</p>
                                    </div>
                                </div>
                            `).join("")}
                        </div>
                        <div class="resultado-secao-card">
                            <div class="resultado-secao-header">
                                <span class="resultado-secao-icon">üå¶Ô∏è</span>
                                <h5 class="resultado-secao-titulo">Clima Ideal</h5>
                            </div>
                            <p class="resultado-clima-texto">${clima}</p>
                        </div>
                    `;

                    resultadoConteudo.innerHTML = html;
                    resultadoConteudo.style.opacity = "0";
                    requestAnimationFrame(() => {
                        resultadoConteudo.style.transition = "opacity 0.5s ease-in";
                        resultadoConteudo.style.opacity = "1";
                    });
                } else {
                    resultadoConteudo.innerHTML = "<p>" + (data.resultado || "Resposta n√£o dispon√≠vel") + "</p>";
                }
            } catch (error) {
                console.error("Erro:", error);
                resultadoConteudo.innerHTML = "<p>‚ùå Erro ao comunicar com o servidor.</p>";
            }
        });
    </script>

</body>
</html>